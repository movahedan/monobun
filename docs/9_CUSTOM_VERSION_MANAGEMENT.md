# 🚀 Custom Version Management with Changesets

> Advanced version management system integrated with Changesets for automated changelog generation and releases

## 📋 Table of Contents

- [Overview](#-overview)
- [Changesets Integration](#-changesets-integration)
- [Scripts](#-scripts)
- [Workflow](#-workflow)
- [Usage Examples](#-usage-examples)
- [Troubleshooting](#-troubleshooting)
- [Related Documentation](#-related-documentation)

## 🎯 Overview

This project uses a custom version management system that integrates with [Changesets](https://github.com/changesets/changesets) for automated changelog generation and version bumping. The system combines the power of Changesets with custom workflow scripts for a streamlined release process.

### **Key Features**

- **Changesets Integration**: Uses Changesets for changelog generation and version management
- **Custom Workflow**: Maintains your preferred workflow with release branches
- **Automated Versioning**: Automatic version bumping based on changeset types
- **Monorepo Support**: Handles multiple packages in the monorepo
- **Git Integration**: Seamless git workflow with release branches

## 🔧 Changesets Integration

The version management system is built on top of Changesets, which provides:

- **Structured Changelog**: Automatic changelog generation from changeset files
- **Semantic Versioning**: Proper version bumping (patch, minor, major)
- **Multi-package Support**: Handles dependencies between packages
- **Release Automation**: Streamlined release process

### **Changesets Configuration**

```json
{
  "$schema": "https://unpkg.com/@changesets/config@3.1.1/schema.json",
  "changelog": "@changesets/cli/changelog",
  "commit": true,
  "fixed": [],
  "linked": [],
  "access": "restricted",
  "baseBranch": "main",
  "updateInternalDependencies": "patch",
  "ignore": []
}
```

## 📁 Scripts

### **Individual Scripts**

```bash
# Individual scripts
scripts/version-init.ts
scripts/version-add.ts
scripts/version-commit.ts
scripts/version-push.ts

# Available commands
bun run version:init
bun run version:add --patch|--minor|--major
bun run version:commit
bun run version:push
```

### **Package.json Scripts**

```json
{
  "scripts": {
    "version:init": "bun run scripts/version-init.ts",
    "version:add": "bun run scripts/version-add.ts",
    "version:commit": "bun run scripts/version-commit.ts",
    "version:push": "bun run scripts/version-push.ts"
  }
}
```

## 🔄 Workflow

### **1. Initialize Release Branch**

```bash
# Start a new release cycle
bun run version:init
```

This creates a release branch from the current version and ensures you're on main with a clean working directory.

### **2. Create Changesets**

```bash
# Create changesets interactively
bunx @changesets/cli add

# Or manually create .changeset/*.md files
```

Create changeset files that describe the changes and their version impact. This is the standard Changesets workflow.

### **3. Generate Changelog**

```bash
# Generate changelog using Changesets
bun run version:add
```

Uses Changesets to generate a proper changelog and update package versions.

### **4. Commit Changes**

```bash
# Commit version bumps and changelog
bun run version:commit
```

Commits all changes including updated package.json files and changelog that were generated by the previous step.

### **5. Push Release**

```bash
# Push release branch
bun run version:push
```

Pushes the release branch for pull request creation.

## 📝 Usage Examples

### **Complete Release Workflow**

```bash
# 1. Initialize release
bun run version:init

# 2. Create changesets for your changes
bunx @changesets/cli add

# 3. Generate changelog and bump versions
bun run version:add

# 4. Commit changes
bun run version:commit

# 5. Push release branch
bun run version:push
```

### **Quick Patch Release**

```bash
bun run version:init
bunx @changesets/cli add  # Create patch changeset
bun run version:add
bun run version:commit
bun run version:push
```

### **Major Version Release**

```bash
bun run version:init
bunx @changesets/cli add  # Create major changeset
bun run version:add
bun run version:commit
bun run version:push
```

## 🚨 Troubleshooting

### **Common Issues**

#### **"No changeset files found"**
```bash
# Create changesets first
bunx @changesets/cli add
# Then run version:add
bun run version:add
```

#### **"Must be on main branch"**
```bash
# Switch to main branch
git checkout main
git pull origin main
bun run version:init
```

#### **"Working directory is not clean"**
```bash
# Commit or stash changes
git add .
git commit -m "feat: your changes"
# OR
git stash
bun run version:init
```

#### **"Changesets version failed"**
```bash
# Check if changesets are properly configured
cat .changeset/config.json

# Try running changesets manually
bunx @changesets/cli version
```

### **Manual Recovery**

```bash
# Reset to main if something goes wrong
git checkout main
git branch -D release/$(node -p "require('./package.json').version")

# Start over
bun run version:init
```

### **Changesets Commands**

```bash
# Manual changesets commands (if needed)
bunx @changesets/cli add          # Create changeset interactively
bunx @changesets/cli version      # Generate changelog and bump versions
bunx @changesets/cli release      # Publish packages (if applicable)
```

## 📚 Related Documentation

- [Development Workflow](./3_DEV_FLOWS.md) - Daily development commands
- [Changesets Versioning](./8_CHANGESETS_VERSIONING.md) - Alternative version management
- [Quality Checklist](./0_QUALITY_CHECKLIST.md) - Testing and validation
- [Setup Flows](./2_SETUP_FLOWS.md) - Environment setup

---

**💡 Pro Tip**: The integration with Changesets provides the best of both worlds - your preferred workflow with the power of automated changelog generation and version management. Follow the standard Changesets workflow by creating changesets first, then using `version:add` to generate changelogs and bump versions. 